"use strict";var w=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var he=Object.prototype.hasOwnProperty;var W=Math.pow;var l=(s,e)=>()=>(s&&(e=s(s=0)),e);var g=(s,e)=>{for(var i in e)w(s,i,{get:e[i],enumerable:!0})},ue=(s,e,i,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of pe(e))!he.call(s,o)&&o!==i&&w(s,o,{get:()=>e[o],enumerable:!(t=le(e,o))||t.enumerable});return s};var b=s=>ue(w({},"__esModule",{value:!0}),s);var ve=(s,e,i)=>{if(!e.has(s))throw TypeError("Cannot "+i)};var E=(s,e,i)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,i)};var C=(s,e,i)=>(ve(s,e,"access private method"),i);var h,G=l(()=>{"use strict";h=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,h.prototype)}}});var z,fe,U,R,V,M,F=l(()=>{"use strict";G();z="A Sequence can only be made new from and Array of Sequence objects that share the same rest symbol and mode",fe="Numbers must be integers",U="A self-similar melody can only be produced for an input sequence length that is coprime with the output sequence length",R=(s,e,i)=>i.indexOf(s)===e,V=(s,e)=>{if(!Number.isInteger(s)||!Number.isInteger(e))throw new h(fe);let i=s>e?e:s;for(let t=2;t<=i;t++)if(s%t===0&&e%t===0)return!1;return!0},M=(s,e)=>{let i=s.slice();if(i.length>e)i.unshift(...i.splice(-e));else{let t=0;for(;t<e;)i.unshift(i.splice(-1)),t++}return i}});var J={};g(J,{Rhythm:()=>S});var S,q=l(()=>{"use strict";D();S=class{constructor(e,i="wrap",t){this.steps=e,this.fillMode=i,this.length=t}applyTo(e){let i=this.steps.filter(r=>r!=0).length,t=Math.ceil(e.steps.length/i),o=new Array(t).fill(this.steps).flat();if(this.length!==void 0){if(this.length>o.length){let r=this.length-o.length;if(this.fillMode=="silence")o.push(...new Array(r).fill(0));else{let c=Math.ceil(r/this.steps.length);o.push(...new Array(c).fill(this.steps).flat())}}o=o.slice(0,this.length)}let n=0;return o.forEach((r,c)=>{r==1?(o[c]=e.steps[n%e.steps.length],n++):o[c]=e.restSymbol}),new d(o,e.restSymbol,e.melodicMode)}}});var Y={};g(Y,{Melody:()=>d,MelodyType:()=>_});var _,d,D=l(()=>{"use strict";G();F();q();_=(i=>(i.MIDI="MIDI",i.Degrees="Scale Degrees",i))(_||{}),d=class{constructor(e,i,t){this.steps=e===void 0?new Array:e,this.restSymbol=i===void 0?0:i,this.melodicMode=t==null?"Scale Degrees":t}clone(){return new d(this.steps,this.restSymbol,this.melodicMode)}static newFrom(e){let i=e.map(n=>n.restSymbol).filter(R),t=e.map(n=>n.melodicMode).filter(R);if(i.length>1||t.length>1)throw new h(z);let o=e.map(n=>n.steps).flat();return new d(o,e[0].restSymbol,e[0].melodicMode)}selfReplicate(e,i){if(i=i===void 0?2:i,!V(e,i))throw new h(U);let t=new Array(e).fill(-1);t[0]=this.steps[0],t[1]=this.steps[1];let o,n,r,c,m=t.findIndex(f=>f==-1),v=2;do{o=t.slice(0,m);for(let f=0;f<o.length;f++){n=o[f];for(let T=1;T<=Math.log2(e);T++)r=W(i,T),t[f*r%e]=n}c=this.steps[v%this.steps.length],m=t.findIndex(f=>f==-1),m!=-1&&(t[m]=c),v++}while(m!=-1);let y=this.clone();return y.steps=t,y}counted(){let e=new Array;for(let t=1;t<=this.steps.length;t++){let o=new Array(t).fill(1);o.push(0);let n=this.steps.length*(t+1);new S(o,"wrap",n).applyTo(this).steps.forEach(c=>e.push(c))}let i=this.clone();return i.steps=e,i}zigZag(){let e=this.steps.length%2==0?this.steps.length/2+1:Math.ceil(this.steps.length/2),i=this.steps.reduce((t,o,n)=>{let r=new Array(e).fill(-1).map((c,m)=>this.steps[(m+n)%this.steps.length]);return t.push(r),t.push(r.slice(1,e).reverse()),t},new Array).flat();return new d(i)}static infinitySeries(e=[0,1],i=16,t=0){let o=new d,n=e[0],c=e[1]-n;return o.steps=Array.from(new Array(i),(m,v)=>v+t).map(m=>n+d.norgardInteger(m)*c),o}static norgardInteger(e){return e.toString(2).split("").map(t=>parseInt(t)).reduce((t,o)=>(o==1?t+=1:t*=-1,t),0)}}});var Z={};g(Z,{Mode:()=>p,Scale:()=>x});var x,O,K,u,p,B=l(()=>{"use strict";F();x=(a=>(a[a.Ionian=0]="Ionian",a[a.Dorian=1]="Dorian",a[a.Phrygian=2]="Phrygian",a[a.Lydian=3]="Lydian",a[a.Mixolydian=4]="Mixolydian",a[a.Aeolian=5]="Aeolian",a[a.Locrian=6]="Locrian",a[a.Major=7]="Major",a[a.Minor=8]="Minor",a[a.MajPentatonic=9]="MajPentatonic",a[a.MinPentatonic=10]="MinPentatonic",a[a.WholeTone=11]="WholeTone",a[a.Chromatic=12]="Chromatic",a[a.GS=13]="GS",a))(x||{}),u=class{constructor(e){E(this,O);this.scale=e,this.name=x[e],[this.stepOffsets,this.scaleDegreeMapping]=C(this,O,K).call(this,e),this.scaleOffsets=u.cummulativeOffsets(this.stepOffsets),this.chordQualities=u.chordQualities(this.stepOffsets)}static cummulativeOffsets(e){return e.reduce((i,t,o,n)=>(i.push(n.slice(0,o).reduce((r,c)=>r+=c,0)),i),[])}static chordQualities(e){return e.reduce((i,t,o,n)=>{let r=M(n,-o),c=r.slice(0,2).reduce((v,y)=>v+y,0),m=r.slice(2,4).reduce((v,y)=>v+y,0);return i.push(u.CHORD_INTERVAL_MAP[[c,m].join(":")]),i},[])}},p=u;O=new WeakSet,K=function(e){let i,t,o=new Array;return i=e==7||e==9?0:e,i=e==8||e==10?5:e,t=M(u.MAJOR_STEP_OFFSETS,-i),e==9?(t.splice(2,2,3),t.splice(-2,2,3),o=[1,2,3,5,6]):e==10?(t.splice(0,2,3),t.splice(-3,2,3),o=[1,3,4,5,7]):e==11?(t=u.WHOLE_TONE_OFFSETS,o=[1,2,3,4,5,6]):e==12?(t=u.CHROMATIC_OFFSETS,o=[1,1.5,2,2.5,3,4,4.5,5,5.5,6,6.5,7]):e==13&&(t=u.GS_OFFSETS),[t,o]},p.MAJOR_STEP_OFFSETS=[2,2,1,2,2,2,1],p.WHOLE_TONE_OFFSETS=[2,2,2,2,2,2],p.CHROMATIC_OFFSETS=[1,1,1,1,1,1,1,1,1,1,1,1],p.GS_OFFSETS=[1,2,1,1,3,1,3],p.CHORD_INTERVAL_MAP={"4:3":"M","3:4":"m","3:3":"dim","4:4":"aug","4:5":"m/3","2:4":"sus25b","5:5":"sus2/2","5:4":"M/5","2:2":"WT","3:2":"m5bb"}});var P,L,j,A,X=l(()=>{"use strict";P=[["B#","C"],["C#","Db"],["Cx","D"],["D#","Eb"],["E","Fb"],["E#","F","Gbb"],["F#","Gb"],["Fx","G"],["G#","Ab"],["Gx","A","Bbb"],["A#","Bb"],["B","Cb"]],L=["C","D","E","F","G","A","B"],j=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],A=[{octave:-2,note:"C",midi:0},{octave:-2,note:"C#",midi:1},{octave:-2,note:"D",midi:2},{octave:-2,note:"D#",midi:3},{octave:-2,note:"E",midi:4},{octave:-2,note:"F",midi:5},{octave:-2,note:"F#",midi:6},{octave:-2,note:"G",midi:7},{octave:-2,note:"G#",midi:8},{octave:-2,note:"A",midi:9},{octave:-2,note:"A#",midi:10},{octave:-2,note:"B",midi:11},{octave:-1,note:"C",midi:12},{octave:-1,note:"C#",midi:13},{octave:-1,note:"D",midi:14},{octave:-1,note:"D#",midi:15},{octave:-1,note:"E",midi:16},{octave:-1,note:"F",midi:17},{octave:-1,note:"F#",midi:18},{octave:-1,note:"G",midi:19},{octave:-1,note:"G#",midi:20},{octave:-1,note:"A",midi:21},{octave:-1,note:"A#",midi:22},{octave:-1,note:"B",midi:23},{octave:0,note:"C",midi:24},{octave:0,note:"C#",midi:25},{octave:0,note:"D",midi:26},{octave:0,note:"D#",midi:27},{octave:0,note:"E",midi:28},{octave:0,note:"F",midi:29},{octave:0,note:"F#",midi:30},{octave:0,note:"G",midi:31},{octave:0,note:"G#",midi:32},{octave:0,note:"A",midi:33},{octave:0,note:"A#",midi:34},{octave:0,note:"B",midi:35},{octave:1,note:"C",midi:36},{octave:1,note:"C#",midi:37},{octave:1,note:"D",midi:38},{octave:1,note:"D#",midi:39},{octave:1,note:"E",midi:40},{octave:1,note:"F",midi:41},{octave:1,note:"F#",midi:42},{octave:1,note:"G",midi:43},{octave:1,note:"G#",midi:44},{octave:1,note:"A",midi:45},{octave:1,note:"A#",midi:46},{octave:1,note:"B",midi:47},{octave:2,note:"C",midi:48},{octave:2,note:"C#",midi:49},{octave:2,note:"D",midi:50},{octave:2,note:"D#",midi:51},{octave:2,note:"E",midi:52},{octave:2,note:"F",midi:53},{octave:2,note:"F#",midi:54},{octave:2,note:"G",midi:55},{octave:2,note:"G#",midi:56},{octave:2,note:"A",midi:57},{octave:2,note:"A#",midi:58},{octave:2,note:"B",midi:59},{octave:3,note:"C",midi:60},{octave:3,note:"C#",midi:61},{octave:3,note:"D",midi:62},{octave:3,note:"D#",midi:63},{octave:3,note:"E",midi:64},{octave:3,note:"F",midi:65},{octave:3,note:"F#",midi:66},{octave:3,note:"G",midi:67},{octave:3,note:"G#",midi:68},{octave:3,note:"A",midi:69},{octave:3,note:"A#",midi:70},{octave:3,note:"B",midi:71},{octave:4,note:"C",midi:72},{octave:4,note:"C#",midi:73},{octave:4,note:"D",midi:74},{octave:4,note:"D#",midi:75},{octave:4,note:"E",midi:76},{octave:4,note:"F",midi:77},{octave:4,note:"F#",midi:78},{octave:4,note:"G",midi:79},{octave:4,note:"G#",midi:80},{octave:4,note:"A",midi:81},{octave:4,note:"A#",midi:82},{octave:4,note:"B",midi:83},{octave:5,note:"C",midi:84},{octave:5,note:"C#",midi:85},{octave:5,note:"D",midi:86},{octave:5,note:"D#",midi:87},{octave:5,note:"E",midi:88},{octave:5,note:"F",midi:89},{octave:5,note:"F#",midi:90},{octave:5,note:"G",midi:91},{octave:5,note:"G#",midi:92},{octave:5,note:"A",midi:93},{octave:5,note:"A#",midi:94},{octave:5,note:"B",midi:95},{octave:6,note:"C",midi:96},{octave:6,note:"C#",midi:97},{octave:6,note:"D",midi:98},{octave:6,note:"D#",midi:99},{octave:6,note:"E",midi:100},{octave:6,note:"F",midi:101},{octave:6,note:"F#",midi:102},{octave:6,note:"G",midi:103},{octave:6,note:"G#",midi:104},{octave:6,note:"A",midi:105},{octave:6,note:"A#",midi:106},{octave:6,note:"B",midi:107},{octave:7,note:"C",midi:108},{octave:7,note:"C#",midi:109},{octave:7,note:"D",midi:110},{octave:7,note:"D#",midi:111},{octave:7,note:"E",midi:112},{octave:7,note:"F",midi:113},{octave:7,note:"F#",midi:114},{octave:7,note:"G",midi:115},{octave:7,note:"G#",midi:116},{octave:7,note:"A",midi:117},{octave:7,note:"A#",midi:118},{octave:7,note:"B",midi:119},{octave:8,note:"C",midi:120},{octave:8,note:"C#",midi:121},{octave:8,note:"D",midi:122},{octave:8,note:"D#",midi:123},{octave:8,note:"E",midi:124},{octave:8,note:"F",midi:125},{octave:8,note:"F#",midi:126},{octave:8,note:"G",midi:127}]});var te={};g(te,{Key:()=>H});var I,ee,H,ie=l(()=>{"use strict";B();X();F();H=class{constructor(e,i){E(this,I);this.scale=i,this.mode=new p(i),typeof e=="string"?(this.tonic=e,this.midiTonic=j.indexOf(e),this.octave=1):(this.tonic=j[e%12],this.midiTonic=e%12,this.octave=A[e].octave),this.scaleName=x[i],this.name=`${this.tonic} ${this.scaleName}`,this.scaleNotes=C(this,I,ee).call(this)}degree(e){let i=this.octave+Math.floor((e-1)/this.scaleNotes.length),t=A[this.mode.scaleOffsets[(e-1)%this.scaleNotes.length]+this.midiTonic+i*12+24];return t.note=this.scaleNotes[(e-1)%this.scaleNotes.length],t}midi2note(e){let i=e%12,t=this.mode.scaleOffsets.indexOf(i);if(t!=-1)return this.scaleNotes[t]+A[e].octave;{let o=A[e].note,n=this.scaleNotes.find(r=>r[0]==o[0]);return o+=n!=null&&n.length==2?"\u266E":"",o+A[e].octave}}};I=new WeakSet,ee=function(){let e=M(P,-P.findIndex(t=>t.includes(this.tonic))),i=M(L,-L.indexOf(this.tonic[0]));return this.mode.scaleDegreeMapping.length!=0&&(i=this.mode.scaleDegreeMapping.map(t=>i[Math.floor(t)-1])),i.map((t,o)=>{let n=this.mode.scaleOffsets[o];return e[n].find(r=>r[0]==t)})}});var oe={};g(oe,{MelodicVector:()=>Q});var Q,ne=l(()=>{"use strict";D();Q=class{constructor(e){this.steps=e}applyTo(e){let i=Math.ceil(e.steps.length/this.steps.length),t=new Array(i).fill(this.steps).flat().slice(0,e.steps.length),o=e.clone();return o.steps=t.map((n,r)=>e.melodicMode=="Scale Degrees"&&e.steps[r]==0?0:e.steps[r]==e.restSymbol?e.steps[r]:n+e.steps[r]),o}}});var se={};g(se,{LindenmayerSystem:()=>$});var $,re=l(()=>{"use strict";$=class{constructor(e){this.axiom=e,this.string=e,this.productionRules={}}add(e){this.productionRules[e.matchStr]=e.output}rules(){return Object.keys(this.productionRules)}advance(){this.string=this.string.split(" ").map(e=>e in this.productionRules?this.productionRules[e]:e).join(" ")}matrix(){let e=new Array;e.push(new Array);let i=0,t=0,o=[i,t];return this.string.split(" ").forEach((n,r)=>{n=="["?(o=[i,t],i=e.length,e.push(new Array),t-=1):n=="]"?(i=o[0],t=o[1]):(e[i][t]=n,t+=1)}),e}}});var ae={};g(ae,{MarkovChain:()=>k});var k,ce=l(()=>{"use strict";k=class{constructor(e){this.input=e,this.stateTransitionMatrix=this.generateStm()}get(e,i){let t=this.stateTransitionMatrix.get(`${e}:${i}`)||[];return t[Math.floor(Math.random()*t.length)]}generateStm(){return this.input.steps.reduce((e,i,t,o)=>{if(t<o.length-1){let n=t==0?i:o[t-1],r=o[t+1],c=`${n}:${i}`,m=e.get(c)||new Array;m.push(r),e.set(c,m)}return e},new Map)}}});var me=(D(),b(Y)),de=(B(),b(Z)),ge=(ie(),b(te)),be=(ne(),b(oe)),ye=(q(),b(J)),Me=(re(),b(se)),Ae=(ce(),b(ae));module.exports.MelodyType=me.MelodyType;module.exports.Melody=me.Melody;module.exports.Mode=de.Mode;module.exports.Scale=de.Scale;module.exports.Key=ge.Key;module.exports.MelodicVector=be.MelodicVector;module.exports.Rhythm=ye.Rhythm;module.exports.LindenmayerSystem=Me.LindenmayerSystem;module.exports.MarkovChain=Ae.MarkovChain;
