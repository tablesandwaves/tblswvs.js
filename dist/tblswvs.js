"use strict";var b=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var q=Math.pow;var a=(i,e)=>()=>(i&&(e=i(i=0)),e);var f=(i,e)=>{for(var s in e)b(i,s,{get:e[s],enumerable:!0})},z=(i,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of G(e))!U.call(i,r)&&r!==s&&b(i,r,{get:()=>e[r],enumerable:!(t=F(e,r))||t.enumerable});return i};var g=i=>z(b({},"__esModule",{value:!0}),i);var u,M=a(()=>{"use strict";u=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,u.prototype)}}});var T,B,N,w,O,C=a(()=>{"use strict";M();T="A Sequence can only be made new from and Array of Sequence objects that share the same rest symbol and mode",B="Numbers must be integers",N="A self-similar melody can only be produced for an input sequence length that is coprime with the output sequence length",w=(i,e,s)=>s.indexOf(i)===e,O=(i,e)=>{if(!Number.isInteger(i)||!Number.isInteger(e))throw new u(B);let s=i>e?e:i;for(let t=2;t<=s;t++)if(i%t===0&&e%t===0)return!1;return!0}});var D={};f(D,{Rhythm:()=>m});var m,I=a(()=>{"use strict";y();m=class{constructor(e,s="wrap",t){this.steps=e,this.fillMode=s,this.length=t}applyTo(e){let s=this.steps.filter(o=>o!=0).length,t=Math.ceil(e.steps.length/s),r=new Array(t).fill(this.steps).flat();if(this.length!==void 0){if(this.length>r.length){let o=this.length-r.length;if(this.fillMode=="silence")r.push(...new Array(o).fill(0));else{let l=Math.ceil(o/this.steps.length);r.push(...new Array(l).fill(this.steps).flat())}}r=r.slice(0,this.length)}let n=0;return r.forEach((o,l)=>{o==1?(r[l]=e.steps[n%e.steps.length],n++):r[l]=e.restSymbol}),new p(r,e.restSymbol,e.melodicMode)}}});var L={};f(L,{Melody:()=>p,MelodyType:()=>x});var x,p,y=a(()=>{"use strict";M();C();I();x=(s=>(s.MIDI="MIDI",s.Degrees="Scale Degrees",s))(x||{}),p=class{constructor(e,s,t){this.steps=e===void 0?new Array:e,this.restSymbol=s===void 0?0:s,this.melodicMode=t==null?"Scale Degrees":t}clone(){return new p(this.steps,this.restSymbol,this.melodicMode)}static newFrom(e){let s=e.map(n=>n.restSymbol).filter(w),t=e.map(n=>n.melodicMode).filter(w);if(s.length>1||t.length>1)throw new u(T);let r=e.map(n=>n.steps).flat();return new p(r,e[0].restSymbol,e[0].melodicMode)}selfReplicate(e,s){if(s=s===void 0?2:s,!O(e,s))throw new u(N);let t=new Array(e).fill(-1);t[0]=this.steps[0],t[1]=this.steps[1];let r,n,o,l,h=t.findIndex(c=>c==-1),d=2;do{r=t.slice(0,h);for(let c=0;c<r.length;c++){n=r[c];for(let S=1;S<=Math.log2(e);S++)o=q(s,S),t[c*o%e]=n}l=this.steps[d%this.steps.length],h=t.findIndex(c=>c==-1),h!=-1&&(t[h]=l),d++}while(h!=-1);let E=this.clone();return E.steps=t,E}counted(){let e=new Array;for(let t=1;t<=this.steps.length;t++){let r=new Array(t).fill(1);r.push(0);let n=this.steps.length*(t+1);new m(r,"wrap",n).applyTo(this).steps.forEach(l=>e.push(l))}let s=this.clone();return s.steps=e,s}zigZag(){let e=this.steps.length%2==0?this.steps.length/2+1:Math.ceil(this.steps.length/2),s=this.steps.reduce((t,r,n)=>{let o=new Array(e).fill(-1).map((l,h)=>this.steps[(h+n)%this.steps.length]);return t.push(o),t.push(o.slice(1,e).reverse()),t},new Array).flat();return new p(s)}static infinitySeries(e=[0,1],s=16,t=0){let r=new p,n=e[0],l=e[1]-n;return r.steps=Array.from(new Array(s),(h,d)=>d+t).map(h=>n+p.norgardInteger(h)*l),r}static norgardInteger(e){return e.toString(2).split("").map(t=>parseInt(t)).reduce((t,r)=>(r==1?t+=1:t*=-1,t),0)}}});var _={};f(_,{MelodicVector:()=>A});var A,P=a(()=>{"use strict";y();A=class{constructor(e){this.steps=e}applyTo(e){let s=Math.ceil(e.steps.length/this.steps.length),t=new Array(s).fill(this.steps).flat().slice(0,e.steps.length),r=e.clone();return r.steps=t.map((n,o)=>e.melodicMode=="Scale Degrees"&&e.steps[o]==0?0:e.steps[o]==e.restSymbol?e.steps[o]:n+e.steps[o]),r}}});var j={};f(j,{LindenmayerSystem:()=>R});var R,v=a(()=>{"use strict";R=class{constructor(e){this.axiom=e,this.string=e,this.productionRules={}}add(e){this.productionRules[e.matchStr]=e.output}rules(){return Object.keys(this.productionRules)}advance(){this.string=this.string.split(" ").map(e=>e in this.productionRules?this.productionRules[e]:e).join(" ")}matrix(){let e=new Array;e.push(new Array);let s=0,t=0,r=[s,t];return this.string.split(" ").forEach((n,o)=>{n=="["?(r=[s,t],s=e.length,e.push(new Array),t-=1):n=="]"?(s=r[0],t=r[1]):(e[s][t]=n,t+=1)}),e}}});var Q=(y(),g(L)),Y=(P(),g(_)),k=(I(),g(D)),V=(v(),g(j));module.exports.MelodyType=Q.MelodyType;module.exports.Melody=Q.Melody;module.exports.MelodicVector=Y.MelodicVector;module.exports.Rhythm=k.Rhythm;module.exports.LindenmayerSystem=V.LindenmayerSystem;
