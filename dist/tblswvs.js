"use strict";var F=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var B=Math.pow;var d=(r,e)=>()=>(r&&(e=r(r=0)),e);var g=(r,e)=>{for(var o in e)F(r,o,{get:e[o],enumerable:!0})},te=(r,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of X(e))!ee.call(r,n)&&n!==o&&F(r,n,{get:()=>e[n],enumerable:!(t=K(e,n))||t.enumerable});return r};var b=r=>te(F({},"__esModule",{value:!0}),r);var p,y=d(()=>{"use strict";p=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,p.prototype)}}});var R,oe,N,E,q,A,G=d(()=>{"use strict";y();R="A Sequence can only be made new from and Array of Sequence objects that share the same rest symbol and mode",oe="Numbers must be integers",N="A self-similar melody can only be produced for an input sequence length that is coprime with the output sequence length",E=(r,e,o)=>o.indexOf(r)===e,q=(r,e)=>{if(!Number.isInteger(r)||!Number.isInteger(e))throw new p(oe);let o=r>e?e:r;for(let t=2;t<=o;t++)if(r%t===0&&e%t===0)return!1;return!0},A=(r,e)=>{let o=r.slice();if(o.length>e)o.unshift(...o.splice(-e));else{let t=0;for(;t<e;)o.unshift(o.splice(-1)),t++}return o}});var k={};g(k,{Rhythm:()=>M});var M,x=d(()=>{"use strict";C();M=class{constructor(e,o="wrap",t){this.steps=e,this.fillMode=o,this.length=t}applyTo(e){let o=this.steps.filter(l=>l!=0).length,t=Math.ceil(e.steps.length/o),n=new Array(t).fill(this.steps).flat();if(this.length!==void 0){if(this.length>n.length){let l=this.length-n.length;if(this.fillMode=="silence")n.push(...new Array(l).fill(0));else{let a=Math.ceil(l/this.steps.length);n.push(...new Array(a).fill(this.steps).flat())}}n=n.slice(0,this.length)}let i=0;return n.forEach((l,a)=>{l==1?(n[a]=e.steps[i%e.steps.length],i++):n[a]=e.restSymbol}),new m(n,e.restSymbol,e.melodicMode)}}});var j={};g(j,{Melody:()=>m,MelodyType:()=>S});var S,m,C=d(()=>{"use strict";y();G();x();S=(o=>(o.MIDI="MIDI",o.Degrees="Scale Degrees",o))(S||{}),m=class{constructor(e,o,t){this.steps=e===void 0?new Array:e,this.restSymbol=o===void 0?0:o,this.melodicMode=t==null?"Scale Degrees":t}clone(){return new m(this.steps,this.restSymbol,this.melodicMode)}static newFrom(e){let o=e.map(i=>i.restSymbol).filter(E),t=e.map(i=>i.melodicMode).filter(E);if(o.length>1||t.length>1)throw new p(R);let n=e.map(i=>i.steps).flat();return new m(n,e[0].restSymbol,e[0].melodicMode)}selfReplicate(e,o){if(o=o===void 0?2:o,!q(e,o))throw new p(N);let t=new Array(e).fill(-1);t[0]=this.steps[0],t[1]=this.steps[1];let n,i,l,a,u=t.findIndex(h=>h==-1),f=2;do{n=t.slice(0,u);for(let h=0;h<n.length;h++){i=n[h];for(let D=1;D<=Math.log2(e);D++)l=B(o,D),t[h*l%e]=i}a=this.steps[f%this.steps.length],u=t.findIndex(h=>h==-1),u!=-1&&(t[u]=a),f++}while(u!=-1);let v=this.clone();return v.steps=t,v}counted(){let e=new Array;for(let t=1;t<=this.steps.length;t++){let n=new Array(t).fill(1);n.push(0);let i=this.steps.length*(t+1);new M(n,"wrap",i).applyTo(this).steps.forEach(a=>e.push(a))}let o=this.clone();return o.steps=e,o}zigZag(){let e=this.steps.length%2==0?this.steps.length/2+1:Math.ceil(this.steps.length/2),o=this.steps.reduce((t,n,i)=>{let l=new Array(e).fill(-1).map((a,u)=>this.steps[(u+i)%this.steps.length]);return t.push(l),t.push(l.slice(1,e).reverse()),t},new Array).flat();return new m(o)}static infinitySeries(e=[0,1],o=16,t=0){let n=new m,i=e[0],a=e[1]-i;return n.steps=Array.from(new Array(o),(u,f)=>f+t).map(u=>i+m.norgardInteger(u)*a),n}static norgardInteger(e){return e.toString(2).split("").map(t=>parseInt(t)).reduce((t,n)=>(n==1?t+=1:t*=-1,t),0)}}});var I,L=d(()=>{"use strict";I=[["B#","C"],["C#","Db"],["Cx","D"],["D#","Eb"],["E","Fb"],["E#","F","Gbb"],["F#","Gb"],["Fx","G"],["G#","Ab"],["Gx","A","Bbb"],["A#","Bb"],["B","Cb"]]});var W={};g(W,{Harmony:()=>_,Scale:()=>Q});var Q,c,_,$=d(()=>{"use strict";G();L();Q=(s=>(s[s.Ionian=0]="Ionian",s[s.Dorian=1]="Dorian",s[s.Phrygian=2]="Phrygian",s[s.Lydian=3]="Lydian",s[s.Mixolydian=4]="Mixolydian",s[s.Aeolian=5]="Aeolian",s[s.Locrian=6]="Locrian",s[s.Major=7]="Major",s[s.Minor=8]="Minor",s[s.MajPentatonic=9]="MajPentatonic",s[s.MinPentatonic=10]="MinPentatonic",s[s.WholeTone=11]="WholeTone",s[s.Chromatic=12]="Chromatic",s[s.GS=13]="GS",s))(Q||{}),c=class{constructor(e,o,t){this.scaleOffsets=e,this.chordQualities=o,this.scaleDegreeMapping=t}static getMode(e){let o,t,n;return o=e==7||e==9?0:e,o=e==8||e==10?5:e,t=A(c.MAJOR_STEP_OFFSETS,-o),e==9?(t.splice(2,2,3),t.splice(-2,2,3),n=[1,2,3,5,6]):e==10?(t.splice(0,2,3),t.splice(-3,2,3),n=[1,3,4,5,7]):e==11?(t=c.WHOLE_TONE_OFFSETS,n=[1,2,3,4,5,6]):e==12?(t=c.CHROMATIC_OFFSETS,n=[1,1.5,2,2.5,3,4,4.5,5,5.5,6,6.5,7]):e==13&&(t=c.GS_OFFSETS),new c(c.cummulativeOffsets(t),c.chordQualities(t),n)}static getScaleNotes(e,o){let t=c.getMode(o),n=A(I,-I.findIndex(l=>l.includes(e))),i=A(c.ABC_NOTES_MIDI_ORDER,-c.ABC_NOTES_MIDI_ORDER.indexOf(e[0]));return t.scaleDegreeMapping!=null&&(i=t.scaleDegreeMapping.map(l=>i[Math.floor(l)-1])),i.map((l,a)=>{let u=t.scaleOffsets[a];return n[u].find(f=>f[0]==l)})}static cummulativeOffsets(e){return e.reduce((o,t,n,i)=>(o.push(i.slice(0,n).reduce((l,a)=>l+=a,0)),o),[])}static chordQualities(e){return e.reduce((o,t,n,i)=>{let l=A(i,-n),a=l.slice(0,2).reduce((f,v)=>f+v,0),u=l.slice(2,4).reduce((f,v)=>f+v,0);switch([a,u].join(":")){case"4:3":{o.push("M");break}case"3:4":{o.push("m");break}case"3:3":{o.push("dim");break}case"4:4":{o.push("aug");break}case"4:5":{o.push("m/3");break}case"2:4":{o.push("sus25b");break}case"5:5":{o.push("sus2/2");break}case"5:4":{o.push("M/5");break}case"2:2":{o.push("WT");break}case"3:2":{o.push("m5bb");break}}return o},[])}},_=c;_.MAJOR_STEP_OFFSETS=[2,2,1,2,2,2,1],_.WHOLE_TONE_OFFSETS=[2,2,2,2,2,2],_.CHROMATIC_OFFSETS=[1,1,1,1,1,1,1,1,1,1,1,1],_.GS_OFFSETS=[1,2,1,1,3,1,3],_.ABC_NOTES_MIDI_ORDER=["C","D","E","F","G","A","B"]});var H={};g(H,{MelodicVector:()=>w});var w,U=d(()=>{"use strict";C();w=class{constructor(e){this.steps=e}applyTo(e){let o=Math.ceil(e.steps.length/this.steps.length),t=new Array(o).fill(this.steps).flat().slice(0,e.steps.length),n=e.clone();return n.steps=t.map((i,l)=>e.melodicMode=="Scale Degrees"&&e.steps[l]==0?0:e.steps[l]==e.restSymbol?e.steps[l]:i+e.steps[l]),n}}});var z={};g(z,{LindenmayerSystem:()=>T});var T,J=d(()=>{"use strict";T=class{constructor(e){this.axiom=e,this.string=e,this.productionRules={}}add(e){this.productionRules[e.matchStr]=e.output}rules(){return Object.keys(this.productionRules)}advance(){this.string=this.string.split(" ").map(e=>e in this.productionRules?this.productionRules[e]:e).join(" ")}matrix(){let e=new Array;e.push(new Array);let o=0,t=0,n=[o,t];return this.string.split(" ").forEach((i,l)=>{i=="["?(n=[o,t],o=e.length,e.push(new Array),t-=1):i=="]"?(o=n[0],t=n[1]):(e[o][t]=i,t+=1)}),e}}});var Y={};g(Y,{MarkovChain:()=>O});var O,V=d(()=>{"use strict";O=class{constructor(e){this.input=e,this.stateTransitionMatrix=this.generateStm()}get(e,o){let t=this.stateTransitionMatrix.get(`${e}:${o}`)||[];return t[Math.floor(Math.random()*t.length)]}generateStm(){return this.input.steps.reduce((e,o,t,n)=>{if(t<n.length-1){let i=t==0?o:n[t-1],l=n[t+1],a=`${i}:${o}`,u=e.get(a)||new Array;u.push(l),e.set(a,u)}return e},new Map)}}});var Z=(C(),b(j)),ne=($(),b(W)),ie=(U(),b(H)),le=(x(),b(k)),se=(J(),b(z)),re=(V(),b(Y));module.exports.MelodyType=Z.MelodyType;module.exports.Melody=Z.Melody;module.exports.Harmony=ne.Harmony;module.exports.MelodicVector=ie.MelodicVector;module.exports.Rhythm=le.Rhythm;module.exports.LindenmayerSystem=se.LindenmayerSystem;module.exports.MarkovChain=re.MarkovChain;
