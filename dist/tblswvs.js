"use strict";var x=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var re=Object.prototype.hasOwnProperty;var L=Math.pow;var h=(a,e)=>()=>(a&&(e=a(a=0)),e);var f=(a,e)=>{for(var i in e)x(a,i,{get:e[i],enumerable:!0})},ae=(a,e,i,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of se(e))!re.call(a,o)&&o!==i&&x(a,o,{get:()=>e[o],enumerable:!(t=ne(e,o))||t.enumerable});return a};var b=a=>ae(x({},"__esModule",{value:!0}),a);var v,D=h(()=>{"use strict";v=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,v.prototype)}}});var j,ce,H,C,Q,y,F=h(()=>{"use strict";D();j="A Sequence can only be made new from and Array of Sequence objects that share the same rest symbol and mode",ce="Numbers must be integers",H="A self-similar melody can only be produced for an input sequence length that is coprime with the output sequence length",C=(a,e,i)=>i.indexOf(a)===e,Q=(a,e)=>{if(!Number.isInteger(a)||!Number.isInteger(e))throw new v(ce);let i=a>e?e:a;for(let t=2;t<=i;t++)if(a%t===0&&e%t===0)return!1;return!0},y=(a,e)=>{let i=a.slice();if(i.length>e)i.unshift(...i.splice(-e));else{let t=0;for(;t<e;)i.unshift(i.splice(-1)),t++}return i}});var W={};f(W,{Rhythm:()=>A});var A,I=h(()=>{"use strict";S();A=class{constructor(e,i="wrap",t){this.steps=e,this.fillMode=i,this.length=t}applyTo(e){let i=this.steps.filter(s=>s!=0).length,t=Math.ceil(e.steps.length/i),o=new Array(t).fill(this.steps).flat();if(this.length!==void 0){if(this.length>o.length){let s=this.length-o.length;if(this.fillMode=="silence")o.push(...new Array(s).fill(0));else{let c=Math.ceil(s/this.steps.length);o.push(...new Array(c).fill(this.steps).flat())}}o=o.slice(0,this.length)}let n=0;return o.forEach((s,c)=>{s==1?(o[c]=e.steps[n%e.steps.length],n++):o[c]=e.restSymbol}),new p(o,e.restSymbol,e.melodicMode)}}});var $={};f($,{Melody:()=>p,MelodyType:()=>T});var T,p,S=h(()=>{"use strict";D();F();I();T=(i=>(i.MIDI="MIDI",i.Degrees="Scale Degrees",i))(T||{}),p=class{constructor(e,i,t){this.steps=e===void 0?new Array:e,this.restSymbol=i===void 0?0:i,this.melodicMode=t==null?"Scale Degrees":t}clone(){return new p(this.steps,this.restSymbol,this.melodicMode)}static newFrom(e){let i=e.map(n=>n.restSymbol).filter(C),t=e.map(n=>n.melodicMode).filter(C);if(i.length>1||t.length>1)throw new v(j);let o=e.map(n=>n.steps).flat();return new p(o,e[0].restSymbol,e[0].melodicMode)}selfReplicate(e,i){if(i=i===void 0?2:i,!Q(e,i))throw new v(H);let t=new Array(e).fill(-1);t[0]=this.steps[0],t[1]=this.steps[1];let o,n,s,c,m=t.findIndex(g=>g==-1),u=2;do{o=t.slice(0,m);for(let g=0;g<o.length;g++){n=o[g];for(let E=1;E<=Math.log2(e);E++)s=L(i,E),t[g*s%e]=n}c=this.steps[u%this.steps.length],m=t.findIndex(g=>g==-1),m!=-1&&(t[m]=c),u++}while(m!=-1);let M=this.clone();return M.steps=t,M}counted(){let e=new Array;for(let t=1;t<=this.steps.length;t++){let o=new Array(t).fill(1);o.push(0);let n=this.steps.length*(t+1);new A(o,"wrap",n).applyTo(this).steps.forEach(c=>e.push(c))}let i=this.clone();return i.steps=e,i}zigZag(){let e=this.steps.length%2==0?this.steps.length/2+1:Math.ceil(this.steps.length/2),i=this.steps.reduce((t,o,n)=>{let s=new Array(e).fill(-1).map((c,m)=>this.steps[(m+n)%this.steps.length]);return t.push(s),t.push(s.slice(1,e).reverse()),t},new Array).flat();return new p(i)}static infinitySeries(e=[0,1],i=16,t=0){let o=new p,n=e[0],c=e[1]-n;return o.steps=Array.from(new Array(i),(m,u)=>u+t).map(m=>n+p.norgardInteger(m)*c),o}static norgardInteger(e){return e.toString(2).split("").map(t=>parseInt(t)).reduce((t,o)=>(o==1?t+=1:t*=-1,t),0)}}});var O,w,G,R=h(()=>{"use strict";O=[["B#","C"],["C#","Db"],["Cx","D"],["D#","Eb"],["E","Fb"],["E#","F","Gbb"],["F#","Gb"],["Fx","G"],["G#","Ab"],["Gx","A","Bbb"],["A#","Bb"],["B","Cb"]],w=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],G=[{octave:-2,note:"C",midi:0},{octave:-2,note:"C#",midi:1},{octave:-2,note:"D",midi:2},{octave:-2,note:"D#",midi:3},{octave:-2,note:"E",midi:4},{octave:-2,note:"F",midi:5},{octave:-2,note:"F#",midi:6},{octave:-2,note:"G",midi:7},{octave:-2,note:"G#",midi:8},{octave:-2,note:"A",midi:9},{octave:-2,note:"A#",midi:10},{octave:-2,note:"B",midi:11},{octave:-1,note:"C",midi:12},{octave:-1,note:"C#",midi:13},{octave:-1,note:"D",midi:14},{octave:-1,note:"D#",midi:15},{octave:-1,note:"E",midi:16},{octave:-1,note:"F",midi:17},{octave:-1,note:"F#",midi:18},{octave:-1,note:"G",midi:19},{octave:-1,note:"G#",midi:20},{octave:-1,note:"A",midi:21},{octave:-1,note:"A#",midi:22},{octave:-1,note:"B",midi:23},{octave:0,note:"C",midi:24},{octave:0,note:"C#",midi:25},{octave:0,note:"D",midi:26},{octave:0,note:"D#",midi:27},{octave:0,note:"E",midi:28},{octave:0,note:"F",midi:29},{octave:0,note:"F#",midi:30},{octave:0,note:"G",midi:31},{octave:0,note:"G#",midi:32},{octave:0,note:"A",midi:33},{octave:0,note:"A#",midi:34},{octave:0,note:"B",midi:35},{octave:1,note:"C",midi:36},{octave:1,note:"C#",midi:37},{octave:1,note:"D",midi:38},{octave:1,note:"D#",midi:39},{octave:1,note:"E",midi:40},{octave:1,note:"F",midi:41},{octave:1,note:"F#",midi:42},{octave:1,note:"G",midi:43},{octave:1,note:"G#",midi:44},{octave:1,note:"A",midi:45},{octave:1,note:"A#",midi:46},{octave:1,note:"B",midi:47},{octave:2,note:"C",midi:48},{octave:2,note:"C#",midi:49},{octave:2,note:"D",midi:50},{octave:2,note:"D#",midi:51},{octave:2,note:"E",midi:52},{octave:2,note:"F",midi:53},{octave:2,note:"F#",midi:54},{octave:2,note:"G",midi:55},{octave:2,note:"G#",midi:56},{octave:2,note:"A",midi:57},{octave:2,note:"A#",midi:58},{octave:2,note:"B",midi:59},{octave:3,note:"C",midi:60},{octave:3,note:"C#",midi:61},{octave:3,note:"D",midi:62},{octave:3,note:"D#",midi:63},{octave:3,note:"E",midi:64},{octave:3,note:"F",midi:65},{octave:3,note:"F#",midi:66},{octave:3,note:"G",midi:67},{octave:3,note:"G#",midi:68},{octave:3,note:"A",midi:69},{octave:3,note:"A#",midi:70},{octave:3,note:"B",midi:71},{octave:4,note:"C",midi:72},{octave:4,note:"C#",midi:73},{octave:4,note:"D",midi:74},{octave:4,note:"D#",midi:75},{octave:4,note:"E",midi:76},{octave:4,note:"F",midi:77},{octave:4,note:"F#",midi:78},{octave:4,note:"G",midi:79},{octave:4,note:"G#",midi:80},{octave:4,note:"A",midi:81},{octave:4,note:"A#",midi:82},{octave:4,note:"B",midi:83},{octave:5,note:"C",midi:84},{octave:5,note:"C#",midi:85},{octave:5,note:"D",midi:86},{octave:5,note:"D#",midi:87},{octave:5,note:"E",midi:88},{octave:5,note:"F",midi:89},{octave:5,note:"F#",midi:90},{octave:5,note:"G",midi:91},{octave:5,note:"G#",midi:92},{octave:5,note:"A",midi:93},{octave:5,note:"A#",midi:94},{octave:5,note:"B",midi:95},{octave:6,note:"C",midi:96},{octave:6,note:"C#",midi:97},{octave:6,note:"D",midi:98},{octave:6,note:"D#",midi:99},{octave:6,note:"E",midi:100},{octave:6,note:"F",midi:101},{octave:6,note:"F#",midi:102},{octave:6,note:"G",midi:103},{octave:6,note:"G#",midi:104},{octave:6,note:"A",midi:105},{octave:6,note:"A#",midi:106},{octave:6,note:"B",midi:107},{octave:7,note:"C",midi:108},{octave:7,note:"C#",midi:109},{octave:7,note:"D",midi:110},{octave:7,note:"D#",midi:111},{octave:7,note:"E",midi:112},{octave:7,note:"F",midi:113},{octave:7,note:"F#",midi:114},{octave:7,note:"G",midi:115},{octave:7,note:"G#",midi:116},{octave:7,note:"A",midi:117},{octave:7,note:"A#",midi:118},{octave:7,note:"B",midi:119},{octave:8,note:"C",midi:120},{octave:8,note:"C#",midi:121},{octave:8,note:"D",midi:122},{octave:8,note:"D#",midi:123},{octave:8,note:"E",midi:124},{octave:8,note:"F",midi:125},{octave:8,note:"F#",midi:126},{octave:8,note:"G",midi:127}]});var V={};f(V,{Mode:()=>l,Scale:()=>U});var U,d,l,N=h(()=>{"use strict";F();R();U=(r=>(r[r.Ionian=0]="Ionian",r[r.Dorian=1]="Dorian",r[r.Phrygian=2]="Phrygian",r[r.Lydian=3]="Lydian",r[r.Mixolydian=4]="Mixolydian",r[r.Aeolian=5]="Aeolian",r[r.Locrian=6]="Locrian",r[r.Major=7]="Major",r[r.Minor=8]="Minor",r[r.MajPentatonic=9]="MajPentatonic",r[r.MinPentatonic=10]="MinPentatonic",r[r.WholeTone=11]="WholeTone",r[r.Chromatic=12]="Chromatic",r[r.GS=13]="GS",r))(U||{}),d=class{constructor(e,i,t){this.scaleOffsets=e,this.chordQualities=i,this.scaleDegreeMapping=t}static get(e){let i,t,o;return i=e==7||e==9?0:e,i=e==8||e==10?5:e,t=y(d.MAJOR_STEP_OFFSETS,-i),e==9?(t.splice(2,2,3),t.splice(-2,2,3),o=[1,2,3,5,6]):e==10?(t.splice(0,2,3),t.splice(-3,2,3),o=[1,3,4,5,7]):e==11?(t=d.WHOLE_TONE_OFFSETS,o=[1,2,3,4,5,6]):e==12?(t=d.CHROMATIC_OFFSETS,o=[1,1.5,2,2.5,3,4,4.5,5,5.5,6,6.5,7]):e==13&&(t=d.GS_OFFSETS),new d(d.cummulativeOffsets(t),d.chordQualities(t),o)}static getScaleNotes(e,i){let t=d.get(i),o=y(O,-O.findIndex(s=>s.includes(e))),n=y(d.ABC_NOTES_MIDI_ORDER,-d.ABC_NOTES_MIDI_ORDER.indexOf(e[0]));return t.scaleDegreeMapping!=null&&(n=t.scaleDegreeMapping.map(s=>n[Math.floor(s)-1])),n.map((s,c)=>{let m=t.scaleOffsets[c];return o[m].find(u=>u[0]==s)})}static cummulativeOffsets(e){return e.reduce((i,t,o,n)=>(i.push(n.slice(0,o).reduce((s,c)=>s+=c,0)),i),[])}static chordQualities(e){return e.reduce((i,t,o,n)=>{let s=y(n,-o),c=s.slice(0,2).reduce((u,M)=>u+M,0),m=s.slice(2,4).reduce((u,M)=>u+M,0);return i.push(d.CHORD_INTERVAL_MAP[[c,m].join(":")]),i},[])}},l=d;l.MAJOR_STEP_OFFSETS=[2,2,1,2,2,2,1],l.WHOLE_TONE_OFFSETS=[2,2,2,2,2,2],l.CHROMATIC_OFFSETS=[1,1,1,1,1,1,1,1,1,1,1,1],l.GS_OFFSETS=[1,2,1,1,3,1,3],l.ABC_NOTES_MIDI_ORDER=["C","D","E","F","G","A","B"],l.CHORD_INTERVAL_MAP={"4:3":"M","3:4":"m","3:3":"dim","4:4":"aug","4:5":"m/3","2:4":"sus25b","5:5":"sus2/2","5:4":"M/5","2:2":"WT","3:2":"m5bb"}});var z={};f(z,{Key:()=>_});var _,J=h(()=>{"use strict";N();R();_=class{constructor(e,i){this.scale=e,this.mode=l.get(e),typeof i=="string"?(this.tonic=i,this.midiTonic=w.indexOf(i),this.octave=1):(this.tonic=w[i%12],this.midiTonic=i%12,this.octave=G[i].octave),this.scaleNotes=l.getScaleNotes(this.tonic,this.scale)}degree(e){let i=this.octave+Math.floor((e-1)/this.scaleNotes.length),t=G[this.mode.scaleOffsets[(e-1)%this.scaleNotes.length]+this.midiTonic+i*12+24];return t.note=this.scaleNotes[(e-1)%this.scaleNotes.length],t}}});var Y={};f(Y,{MelodicVector:()=>B});var B,K=h(()=>{"use strict";S();B=class{constructor(e){this.steps=e}applyTo(e){let i=Math.ceil(e.steps.length/this.steps.length),t=new Array(i).fill(this.steps).flat().slice(0,e.steps.length),o=e.clone();return o.steps=t.map((n,s)=>e.melodicMode=="Scale Degrees"&&e.steps[s]==0?0:e.steps[s]==e.restSymbol?e.steps[s]:n+e.steps[s]),o}}});var Z={};f(Z,{LindenmayerSystem:()=>q});var q,X=h(()=>{"use strict";q=class{constructor(e){this.axiom=e,this.string=e,this.productionRules={}}add(e){this.productionRules[e.matchStr]=e.output}rules(){return Object.keys(this.productionRules)}advance(){this.string=this.string.split(" ").map(e=>e in this.productionRules?this.productionRules[e]:e).join(" ")}matrix(){let e=new Array;e.push(new Array);let i=0,t=0,o=[i,t];return this.string.split(" ").forEach((n,s)=>{n=="["?(o=[i,t],i=e.length,e.push(new Array),t-=1):n=="]"?(i=o[0],t=o[1]):(e[i][t]=n,t+=1)}),e}}});var ee={};f(ee,{MarkovChain:()=>P});var P,te=h(()=>{"use strict";P=class{constructor(e){this.input=e,this.stateTransitionMatrix=this.generateStm()}get(e,i){let t=this.stateTransitionMatrix.get(`${e}:${i}`)||[];return t[Math.floor(Math.random()*t.length)]}generateStm(){return this.input.steps.reduce((e,i,t,o)=>{if(t<o.length-1){let n=t==0?i:o[t-1],s=o[t+1],c=`${n}:${i}`,m=e.get(c)||new Array;m.push(s),e.set(c,m)}return e},new Map)}}});var ie=(S(),b($)),oe=(N(),b(V)),me=(J(),b(z)),de=(K(),b(Y)),le=(I(),b(W)),pe=(X(),b(Z)),ue=(te(),b(ee));module.exports.MelodyType=ie.MelodyType;module.exports.Melody=ie.Melody;module.exports.Mode=oe.Mode;module.exports.Scale=oe.Scale;module.exports.Key=me.Key;module.exports.MelodicVector=de.MelodicVector;module.exports.Rhythm=le.Rhythm;module.exports.LindenmayerSystem=pe.LindenmayerSystem;module.exports.MarkovChain=ue.MarkovChain;
